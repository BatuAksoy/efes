FROM golang:1.9.2 AS builder
WORKDIR /go/src/github.com/putdotio/efes/
RUN go get github.com/golang/dep/cmd/dep
ADD Gopkg.toml Gopkg.lock /go/src/github.com/putdotio/efes/
RUN dep ensure -vendor-only
RUN apt-get update && apt-get install -y mysql-client
ADD docker-run-tests.sh /root/run-tests.sh
ADD docker-wait-for-db.sh /root/wait-for-db.sh
ADD main.go /go/src/github.com/putdotio/efes/
ADD config /go/src/github.com/putdotio/efes/config/
ADD tracker /go/src/github.com/putdotio/efes/tracker/
ADD server /go/src/github.com/putdotio/efes/server/
ENTRYPOINT ["/bin/bash", "/root/run-tests.sh"]
