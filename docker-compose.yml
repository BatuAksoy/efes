version: '3.3'
services:
  db:
    build:
      dockerfile: Dockerfile.db
      context: .
  db_setup:
    entrypoint: ["/root/docker-wait-for-db.sh", "efes_db_1", "mogilefs", "123", "mogilefs", "INSERT INTO host (host_id, status, hostname, hostip) VALUES (1, 'alive', 's1', $EXTERNAL_IP)"]
    build:
      dockerfile: Dockerfile.db
      context: .
    depends_on:
      - db
  tracker:
    build:
      dockerfile: Dockerfile.tracker
      context: .
    ports:
      - "8001:8001"
    depends_on:
      - db
  server1:
    build:
      dockerfile: Dockerfile.server
      context: .
    environment:
      datadir: /srv/mogilefs/dev1
    depends_on:
      - db
  server2:
    build:
      dockerfile: Dockerfile.server
      context: .
    environment:
      datadir: /srv/mogilefs/dev2
    depends_on:
      - db
